# Azure security baseline for Linux Virtual Machines

* Article
* 05/31/2023
* 2 contributors

Feedback

## In this article

This security baseline applies guidance from the [Azure Security Benchmark version 1.0](/en-us/azure/security/benchmarks/overview-v1) to Linux Virtual Machines. The Azure Security Benchmark provides recommendations on how you can secure your cloud solutions on Azure. The content is grouped by the **security controls** defined by the Azure Security Benchmark and the related guidance applicable to Linux Virtual Machines.

You can monitor this security baseline and its recommendations using Microsoft Defender for Cloud. Azure Policy definitions will be listed in the Regulatory Compliance section of the Microsoft Defender for Cloud dashboard.

When a section has relevant Azure Policy Definitions, they are listed in this baseline to help you measure compliance to the Azure Security Benchmark controls and recommendations. Some recommendations may require a paid Microsoft Defender plan to enable certain security scenarios.

Note

**Controls** not applicable to Linux Virtual Machines, and those for which the global guidance is recommended verbatim, have been excluded. To see how Linux Virtual Machines completely maps to the Azure Security Benchmark, see the **[full Linux Virtual Machines security baseline mapping file](https://github.com/MicrosoftDocs/SecurityBenchmarks/raw/master/Azure%20Offer%20Security%20Baselines/1.1/linux-virtual-machines-security-baseline-v1.1.xlsx)**.

## Network Security

*For more information, see the [Azure Security Benchmark: Network Security](../security-control-network-security).*

### 1.1: Protect Azure resources within virtual networks

**Guidance**: When you create an Azure virtual machine (VM), you must create a virtual network (VNet) or use an existing VNet and configure the VM with a subnet. Ensure that all deployed subnets have a Network Security Group applied with network access controls specific to your applications trusted ports and sources.

Alternatively, if you have a specific use case for a centralized firewall, Azure Firewall can also be used to meet those requirements.

* [Virtual networks and virtual machines in Azure](/en-us/azure/virtual-machines/network-overview)
* [How to create a Virtual Network](/en-us/azure/virtual-network/quick-create-portal)
* [How to create an NSG with a Security Config](/en-us/azure/virtual-network/tutorial-filter-network-traffic)
* [How to deploy and configure Azure Firewall](/en-us/azure/firewall/tutorial-firewall-deploy-portal)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Internet-facing virtual machines should be protected with network security groups](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Ff6de0be7-9a8a-4b8a-b349-43cf02d22f7c) | Protect your virtual machines from potential threats by restricting access to them with network security groups (NSG). Learn more about controlling traffic with NSGs at [https://aka.ms/nsg-doc](/en-us/azure/virtual-network/network-security-groups-overview) | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_NetworkSecurityGroupsOnInternetFacingVirtualMachines_Audit.json) |
| [IP Forwarding on your virtual machine should be disabled](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fbd352bd5-2853-4985-bf0d-73806b4a5744) | Enabling IP forwarding on a virtual machine's NIC allows the machine to receive traffic addressed to other destinations. IP forwarding is rarely required (e.g., when using the VM as a network virtual appliance), and therefore, this should be reviewed by the network security team. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_IPForwardingOnVirtualMachines_Audit.json) |
| [Management ports should be closed on your virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F22730e10-96f6-4aac-ad84-9383d35b5917) | Open remote management ports are exposing your VM to a high level of risk from Internet-based attacks. These attacks attempt to brute force credentials to gain admin access to the machine. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_OpenManagementPortsOnVirtualMachines_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Adaptive network hardening recommendations should be applied on internet facing virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F08e6af2d-db70-460a-bfe9-d5bd474ba9d6) | Microsoft Defender for Cloud analyzes the traffic patterns of Internet facing virtual machines and provides Network Security Group rule recommendations that reduce the potential attack surface | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_AdaptiveNetworkHardenings_Audit.json) |
| [Internet-facing virtual machines should be protected with network security groups](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Ff6de0be7-9a8a-4b8a-b349-43cf02d22f7c) | Protect your virtual machines from potential threats by restricting access to them with network security groups (NSG). Learn more about controlling traffic with NSGs at [https://aka.ms/nsg-doc](/en-us/azure/virtual-network/network-security-groups-overview) | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_NetworkSecurityGroupsOnInternetFacingVirtualMachines_Audit.json) |
| [IP Forwarding on your virtual machine should be disabled](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fbd352bd5-2853-4985-bf0d-73806b4a5744) | Enabling IP forwarding on a virtual machine's NIC allows the machine to receive traffic addressed to other destinations. IP forwarding is rarely required (e.g., when using the VM as a network virtual appliance), and therefore, this should be reviewed by the network security team. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_IPForwardingOnVirtualMachines_Audit.json) |
| [Management ports of virtual machines should be protected with just-in-time network access control](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fb0f33259-77d7-4c9e-aac6-3aabcfae693c) | Possible network Just In Time (JIT) access will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_JITNetworkAccess_Audit.json) |
| [Management ports should be closed on your virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F22730e10-96f6-4aac-ad84-9383d35b5917) | Open remote management ports are exposing your VM to a high level of risk from Internet-based attacks. These attacks attempt to brute force credentials to gain admin access to the machine. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_OpenManagementPortsOnVirtualMachines_Audit.json) |

### 1.2: Monitor and log the configuration and traffic of virtual networks, subnets, and network interfaces

**Guidance**: Use the Microsoft Defender for Cloud to identify and follow network protection recommendations to help secure your Azure Virtual Machine (VM) resources in Azure. Enable NSG flow logs and send logs into a Storage Account for traffic audit for the VMs for unusual activity.

* [How to Enable NSG Flow Logs](/en-us/azure/network-watcher/network-watcher-nsg-flow-logging-portal)
* [Understand Network Security provided by Microsoft Defender for Cloud](/en-us/azure/security-center/security-center-network-recommendations)

**Responsibility**: Customer

### 1.3: Protect critical web applications

**Guidance**: If using your virtual machine (VM) to host web applications, use a network security group (NSG) on the VM's subnet to limit what network traffic, ports and protocols are allowed to communicate. Follow a least privileged network approach when configuring your NSGs to only allow required traffic to your application.

You can also deploy Azure Web Application Firewall (WAF) in front of critical web applications for additional inspection of incoming traffic. Enable Diagnostic Setting for WAF and ingest logs into a Storage Account, Event Hub, or Log Analytics Workspace.

* [Create an application gateway with a Web Application Firewall using the Azure portal](/en-us/azure/web-application-firewall/ag/application-gateway-web-application-firewall-portal)
* [Virtual networks and virtual machines in Azure](/en-us/azure/virtual-machines/network-overview)
* [Information on Network Security Groups](/en-us/azure/virtual-network/tutorial-filter-network-traffic)

**Responsibility**: Customer

### 1.4: Deny communications with known-malicious IP addresses

**Guidance**: Enable Distributed Denial of Service (DDoS) Standard protection on the Virtual Networks to guard against DDoS attacks. Using Microsoft Defender for Cloud Integrated Threat Intelligence, you can monitor communications with known malicious IP addresses. Configure Azure Firewall on each of your Virtual Network segments, with Threat Intelligence enabled and configured to "Alert and deny" for malicious network traffic.

You can use Microsoft Defender for Cloud's Just In Time Network access to limit exposure of Linux Virtual Machines to the approved IP addresses for a limited period. Also, use Microsoft Defender for Cloud Adaptive Network Hardening to recommend NSG configurations that limit ports and source IPs based on actual traffic and threat intelligence.

* [How to configure DDoS protection](/en-us/azure/ddos-protection/manage-ddos-protection)
* [How to deploy Azure Firewall](/en-us/azure/firewall/tutorial-firewall-deploy-portal)
* [Understand Microsoft Defender for Cloud Integrated Threat Intelligence](/en-us/azure/security-center/azure-defender)
* [Understand Microsoft Defender for Cloud Adaptive Network Hardening](/en-us/azure/security-center/security-center-adaptive-network-hardening)
* [Understanding just-in-time virtual machine access in Microsoft Defender for Cloud](/en-us/azure/security-center/just-in-time-explained)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Adaptive network hardening recommendations should be applied on internet facing virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F08e6af2d-db70-460a-bfe9-d5bd474ba9d6) | Microsoft Defender for Cloud analyzes the traffic patterns of Internet facing virtual machines and provides Network Security Group rule recommendations that reduce the potential attack surface | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_AdaptiveNetworkHardenings_Audit.json) |
| [Management ports of virtual machines should be protected with just-in-time network access control](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fb0f33259-77d7-4c9e-aac6-3aabcfae693c) | Possible network Just In Time (JIT) access will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_JITNetworkAccess_Audit.json) |

### 1.5: Record network packets

**Guidance**: You can record NSG flow logs into a storage account to generate flow records for your Azure Virtual Machines. When investigating anomalous activity, you could enable Network Watcher packet capture so that network traffic can be reviewed for unusual and unexpected activity.

* [How to Enable NSG Flow Logs](/en-us/azure/network-watcher/network-watcher-nsg-flow-logging-portal)
* [How to enable Network Watcher](/en-us/azure/network-watcher/network-watcher-create)

**Responsibility**: Customer

### 1.6: Deploy network-based intrusion detection/intrusion prevention systems (IDS/IPS)

**Guidance**: By combining packet captures provided by Network Watcher and an open-source IDS tool, you can perform network intrusion detection for a wide range of threats. Also, you can deploy Azure Firewall on the Virtual Network segments as appropriate, with Threat Intelligence enabled and configured to "Alert and deny" for malicious network traffic.

* [Perform network intrusion detection with Network Watcher and open-source tools](/en-us/azure/network-watcher/network-watcher-intrusion-detection-open-source-tools)
* [How to deploy Azure Firewall](/en-us/azure/firewall/tutorial-firewall-deploy-portal)
* [How to configure alerts with Azure Firewall](/en-us/azure/firewall/threat-intel)

**Responsibility**: Customer

### 1.7: Manage traffic to web applications

**Guidance**: You may deploy Azure Application Gateway for web applications with HTTPS/SSL enabled for trusted certificates. With Azure Application Gateway, you direct your application web traffic to specific resources by assigning listeners to ports, creating rules, and adding resources to a backend pool like Linux virtual machines.

* [How to deploy Application Gateway](/en-us/azure/application-gateway/quick-create-portal)
* [How to configure Application Gateway to use HTTPS](/en-us/azure/application-gateway/create-ssl-portal)
* [Understand layer 7 load balancing with Azure web application gateways](/en-us/azure/application-gateway/overview)

**Responsibility**: Customer

### 1.8: Minimize complexity and administrative overhead of network security rules

**Guidance**: Use Virtual Network Service Tags to define network access controls on Network Security Groups or Azure Firewall configured for your Azure Virtual machines. You can use service tags in place of specific IP addresses when creating security rules. By specifying the service tag name (e.g., ApiManagement) in the appropriate source or destination field of a rule, you can allow or deny the traffic for the corresponding service. Microsoft manages the address prefixes encompassed by the service tag and automatically updates the service tag as addresses change.

* [Understand and using Service Tags](/en-us/azure/virtual-network/service-tags-overview)

**Responsibility**: Customer

### 1.9: Maintain standard security configurations for network devices

**Guidance**: Define and implement standard security configurations for Azure Virtual Machines (VM) using Azure Policy. You may also use Azure Blueprints to simplify large-scale Azure VM deployments by packaging key environment artifacts, such as Azure Resource Manager templates, role assignments, and Azure Policy assignments, in a single blueprint definition. You can apply the blueprint to subscriptions, and enable resource management through blueprint versioning.

* [How to configure and manage Azure Policy](/en-us/azure/governance/policy/tutorials/create-and-manage)
* [Azure Policy samples for networking](/en-us/azure/governance/policy/samples/built-in-policies#network)
* [How to create an Azure Blueprint](/en-us/azure/governance/blueprints/create-blueprint-portal)

**Responsibility**: Customer

### 1.10: Document traffic configuration rules

**Guidance**: You may use Tags for NSGs and other resources related to network security and traffic flow configured for your Azure Virtual machines. For individual NSG rules, use the "Description" field to specify business need and/or duration for any rules that allow traffic to/from a network.

* [How to create and use tags](/en-us/azure/azure-resource-manager/management/tag-resources)
* [How to create a Virtual Network](/en-us/azure/virtual-network/quick-create-portal)
* [How to create an NSG with a Security Config](/en-us/azure/virtual-network/tutorial-filter-network-traffic)

**Responsibility**: Customer

### 1.11: Use automated tools to monitor network resource configurations and detect changes

**Guidance**: Use the Azure Activity Log to monitor changes to network resource configurations related to your virtual machines. Create alerts within Azure Monitor that will trigger when changes to critical network settings or resources take place.

Use Azure Policy to validate (and/or remediate) configurations for network resource related to Linux Virtual Machines.

* [How to view and retrieve Azure Activity Log events](/en-us/azure/azure-monitor/essentials/activity-log#view-the-activity-log)
* [How to create alerts in Azure Monitor](/en-us/azure/azure-monitor/alerts/alerts-activity-log)
* [How to configure and manage Azure Policy](/en-us/azure/governance/policy/tutorials/create-and-manage)
* [Azure Policy samples for networking](/en-us/azure/governance/policy/samples/built-in-policies#network)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Add system-assigned managed identity to enable Guest Configuration assignments on virtual machines with no identities](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F3cf2ab00-13f1-4d0c-8971-2ac904541a7e) | This policy adds a system-assigned managed identity to virtual machines hosted in Azure that are supported by Guest Configuration but do not have any managed identities. A system-assigned managed identity is a prerequisite for all Guest Configuration assignments and must be added to machines before using any Guest Configuration policy definitions. For more information on Guest Configuration, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). | modify | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_AddSystemIdentityWhenNone_Prerequisite.json) |
| [Add system-assigned managed identity to enable Guest Configuration assignments on VMs with a user-assigned identity](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F497dff13-db2a-4c0f-8603-28fa3b331ab6) | This policy adds a system-assigned managed identity to virtual machines hosted in Azure that are supported by Guest Configuration and have at least one user-assigned identity but do not have a system-assigned managed identity. A system-assigned managed identity is a prerequisite for all Guest Configuration assignments and must be added to machines before using any Guest Configuration policy definitions. For more information on Guest Configuration, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). | modify | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_AddSystemIdentityWhenUser_Prerequisite.json) |
| [Deploy the Windows Guest Configuration extension to enable Guest Configuration assignments on Windows VMs](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F385f5831-96d4-41db-9a3c-cd3af78aaae6) | This policy deploys the Windows Guest Configuration extension to Windows virtual machines hosted in Azure that are supported by Guest Configuration. The Windows Guest Configuration extension is a prerequisite for all Windows Guest Configuration assignments and must be deployed to machines before using any Windows Guest Configuration policy definition. For more information on Guest Configuration, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). | deployIfNotExists | [1.0.1](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_DeployExtensionWindows_Prerequisite.json) |
| [Windows machines should meet requirements for 'Administrative Templates - Network'](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F67e010c1-640d-438e-a3a5-feaccb533a98) | Windows machines should have the specified Group Policy settings in the category 'Administrative Templates - Network' for guest logons, simultaneous connections, network bridge, ICS, and multicast name resolution. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). | AuditIfNotExists, Disabled | [2.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_AdministrativeTemplatesNetwork_AINE.json) |
| [Windows machines should meet requirements for 'Security Options - Microsoft Network Server'](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fcaf2d518-f029-4f6b-833b-d7081702f253) | Windows machines should have the specified Group Policy settings in the category 'Security Options - Microsoft Network Server' for disabling SMB v1 server. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). | AuditIfNotExists, Disabled | [2.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_SecurityOptionsMicrosoftNetworkServer_AINE.json) |
| [Windows machines should meet requirements for 'Security Options - Network Access'](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F3ff60f98-7fa4-410a-9f7f-0b00f5afdbdd) | Windows machines should have the specified Group Policy settings in the category 'Security Options - Network Access' for including access for anonymous users, local accounts, and remote access to the registry. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). | AuditIfNotExists, Disabled | [2.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_SecurityOptionsNetworkAccess_AINE.json) |
| [Windows machines should meet requirements for 'Security Options - Network Security'](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F1221c620-d201-468c-81e7-2817e6107e84) | Windows machines should have the specified Group Policy settings in the category 'Security Options - Network Security' for including Local System behavior, PKU2U, LAN Manager, LDAP client, and NTLM SSP. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). | AuditIfNotExists, Disabled | [2.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_SecurityOptionsNetworkSecurity_AINE.json) |

## Logging and Monitoring

*For more information, see the [Azure Security Benchmark: Logging and Monitoring](../security-control-logging-monitoring).*

### 2.1: Use approved time synchronization sources

**Guidance**: Microsoft maintains time sources for Azure resources, however, you have the option to manage the time synchronization settings for your Linux Virtual Machines.

* [How to configure time synchronization for Azure compute resources](/en-us/azure/virtual-machines/linux/time-sync)

**Responsibility**: Shared

### 2.2: Configure central security log management

**Guidance**: The Microsoft Defender for Cloud provides Security Event log monitoring for Linux Virtual Machines.

* [Data collection in Microsoft Defender for Cloud](/en-us/azure/security-center/security-center-enable-data-collection)
* [To capture the Syslog data for monitoring, you will need to enable the Log Analytics extension](/en-us/azure/azure-monitor/vm/quick-collect-azurevm#enable-the-log-analytics-vm-extension)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Audit Windows machines on which the Log Analytics agent is not connected as expected](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F6265018c-d7e2-432f-a75d-094d5f6f4465) | Requires that prerequisites are deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). Machines are non-compliant if the agent is not installed, or if it is installed but the COM object AgentConfigManager.MgmtSvcCfg returns that it is registered to a workspace other than the ID specified in the policy parameter. | auditIfNotExists | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_WindowsLogAnalyticsAgentConnection_AINE.json) |
| [The Log Analytics agent should be installed on Virtual Machine Scale Sets](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fefbde977-ba53-4479-b8e9-10b957924fbf) | This policy audits any Windows/Linux Virtual Machine Scale Sets if the Log Analytics agent is not installed. | AuditIfNotExists, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Monitoring/VMSS_LogAnalyticsAgent_AuditIfNotExists.json) |
| [The Log Analytics agent should be installed on virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fa70ca396-0a34-413a-88e1-b956c1e683be) | This policy audits any Windows/Linux virtual machines if the Log Analytics agent is not installed. | AuditIfNotExists, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Monitoring/VirtualMachines_LogAnalyticsAgent_AuditIfNotExists.json) |

### 2.3: Enable audit logging for Azure resources

**Guidance**: Activity logs can be used to audit operations and actions performed on virtual machine resources. The activity log contains all write operations (PUT, POST, DELETE) for your resources except read operations (GET). Activity logs can be used to find an error when troubleshooting or to monitor how a user in your organization modified a resource.

Enable the collection of guest OS diagnostic data by deploying the diagnostic extension on your Virtual Machines (VM). You can use the diagnostics extension to collect diagnostic data like application logs or performance counters from an Azure virtual machine.

For advanced visibility of the applications and services supported by your virtual machines you can enable both Azure Monitor for VMs and Application insights. With Application Insights, you can monitor your application and capture telemetry such as HTTP requests, exceptions, and others so you can correlate issues between the VMs and your application.

Additionally, enable Azure Monitor for access to your audit and activity logs which includes event source, date, user, timestamp, source addresses, destination addresses, and other useful elements.

* [How to collect platform logs and metrics with Azure Monitor](/en-us/azure/azure-monitor/essentials/diagnostic-settings)
* [Log analytics agent overview](/en-us/azure/azure-monitor/agents/log-analytics-agent)
* [Log analytics virtual machine extension for Linux](/en-us/azure/virtual-machines/extensions/oms-linux)
* [View and retrieve Azure Activity log events](/en-us/azure/azure-monitor/platform/activity-log-view)
* [Application Insights overview](/en-us/azure/azure-monitor/app/app-insights-overview)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Resource logs in Virtual Machine Scale Sets should be enabled](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F7c1b1214-f927-48bf-8882-84f0af6588b1) | It is recommended to enable Logs so that activity trail can be recreated when investigations are required in the event of an incident or a compromise. | AuditIfNotExists, Disabled | [2.0.1](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Compute/ServiceFabric_and_VMSS_AuditVMSSDiagnostics.json) |

### 2.4: Collect security logs from operating systems

**Guidance**: Use Microsoft Defender for Cloud to provide Security Event log monitoring for Azure Virtual Machines. Given the volume of data that the security event log generates, it is not stored by default.

If your organization would like to retain the security event log data from the virtual machine, it can be stored within a Log Analytics Workspace at the desired data collection tier configured within Microsoft Defender for Cloud.

* [Data collection in Microsoft Defender for Cloud](/en-us/azure/security-center/security-center-enable-data-collection)
* [To capture the Syslog data for monitoring, you will need to enable the Log Analytics extension](/en-us/azure/azure-monitor/vm/quick-collect-azurevm#enable-the-log-analytics-vm-extension)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Audit Windows machines on which the Log Analytics agent is not connected as expected](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F6265018c-d7e2-432f-a75d-094d5f6f4465) | Requires that prerequisites are deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). Machines are non-compliant if the agent is not installed, or if it is installed but the COM object AgentConfigManager.MgmtSvcCfg returns that it is registered to a workspace other than the ID specified in the policy parameter. | auditIfNotExists | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_WindowsLogAnalyticsAgentConnection_AINE.json) |
| [The Log Analytics agent should be installed on Virtual Machine Scale Sets](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fefbde977-ba53-4479-b8e9-10b957924fbf) | This policy audits any Windows/Linux Virtual Machine Scale Sets if the Log Analytics agent is not installed. | AuditIfNotExists, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Monitoring/VMSS_LogAnalyticsAgent_AuditIfNotExists.json) |
| [The Log Analytics agent should be installed on virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fa70ca396-0a34-413a-88e1-b956c1e683be) | This policy audits any Windows/Linux virtual machines if the Log Analytics agent is not installed. | AuditIfNotExists, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Monitoring/VirtualMachines_LogAnalyticsAgent_AuditIfNotExists.json) |

### 2.5: Configure security log storage retention

**Guidance**: Ensure that any storage accounts or Log Analytics workspaces used for storing virtual machine logs has the log retention period set according to your organization's compliance regulations.

* [How to monitor virtual machines in Azure](/en-us/azure/azure-monitor/vm/monitor-vm-azure)
* [How to configure Log Analytics Workspace Retention Period](/en-us/azure/azure-monitor/logs/manage-cost-storage)

**Responsibility**: Customer

### 2.6: Monitor and review logs

**Guidance**: Enable the Log Analytics agent, also referred to as the Microsoft Monitoring Agent (MMA) or OMS Linux agent, and configure it to send logs to a Log Analytics workspace. The Linux agent sends collected data from different sources to your Log Analytics workspace in Azure Monitor, as well as any unique logs or metrics as defined in a monitoring solution.

Analyze and monitor logs for anomalous behavior and regularly review results. Use Azure Monitor to review logs and perform queries on log data.

Alternatively, you may enable and on-board data to Microsoft Sentinel or a third-party SIEM to monitor and review your logs.

* [Log analytics agent overview](/en-us/azure/azure-monitor/platform/log-analytics-agent)
* [Log analytics virtual machine extension for Linux](/en-us/azure/virtual-machines/extensions/oms-linux)
* [How to onboard Microsoft Sentinel](/en-us/azure/sentinel/quickstart-onboard)
* [Understand Log Analytics Workspace](/en-us/azure/azure-monitor/logs/log-analytics-tutorial)
* [How to perform custom queries in Azure Monitor](/en-us/azure/azure-monitor/logs/get-started-queries)

**Responsibility**: Customer

### 2.7: Enable alerts for anomalous activities

**Guidance**: Use Microsoft Defender for Cloud configured with a Log Analytics workspace for monitoring and alerting on anomalous activity found in security logs and events for your Azure Virtual Machines.

Alternatively, you may enable and on-board data to Microsoft Sentinel or a third-party SIEM to set up alerts for anomalous activity.

* [How to onboard Microsoft Sentinel](/en-us/azure/sentinel/quickstart-onboard)
* [How to manage alerts in Microsoft Defender for Cloud](/en-us/azure/security-center/security-center-managing-and-responding-alerts)
* [How to alert on log analytics log data](/en-us/azure/azure-monitor/alerts/tutorial-response)

**Responsibility**: Customer

### 2.8: Centralize anti-malware logging

**Guidance**: You will need a third-party tool for anti-malware vulnerability detection for inside the Linux OS.

* [Instructions for onboarding Linux servers to Microsoft Defender for Cloud](/en-us/azure/security-center/quickstart-onboard-machines)
* [Following link provides the Microsoft recommended security guidelines, which can serve as a criteria list for the vulnerability software selected](/en-us/azure/virtual-machines/linux/security-recommendations)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Monitor missing Endpoint Protection in Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Faf6cd1bd-1635-48cb-bde7-5b15693900b9) | Servers without an installed Endpoint Protection agent will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_MissingEndpointProtection_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Endpoint protection solution should be installed on virtual machine scale sets](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F26a828e1-e88f-464e-bbb3-c134a282b9de) | Audit the existence and health of an endpoint protection solution on your virtual machines scale sets, to protect them from threats and vulnerabilities. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_VmssMissingEndpointProtection_Audit.json) |
| [Microsoft Antimalware for Azure should be configured to automatically update protection signatures](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fc43e4a30-77cb-48ab-a4dd-93f175c63b57) | This policy audits any Windows virtual machine not configured with automatic update of Microsoft Antimalware protection signatures. | AuditIfNotExists, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Compute/VirtualMachines_AntiMalwareAutoUpdate_AuditIfNotExists.json) |
| [Monitor missing Endpoint Protection in Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Faf6cd1bd-1635-48cb-bde7-5b15693900b9) | Servers without an installed Endpoint Protection agent will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_MissingEndpointProtection_Audit.json) |

### 2.9: Enable DNS query logging

**Guidance**: Implement a third-party solution from Azure Marketplace for DNS logging solution as per your organization's needs.

**Responsibility**: Customer

### 2.10: Enable command-line audit logging

**Guidance**: You can manually configure console logging on a per-node basis and use syslogs to store the data. Also, use Azure Monitor's Log Analytics workspace to review logs and perform queries on syslog data from Azure Virtual machines.

* [How to perform custom queries in Azure Monitor](/en-us/azure/azure-monitor/logs/get-started-queries)
* [Syslog data sources in Azure Monitor](/en-us/azure/azure-monitor/agents/data-sources-syslog)

**Responsibility**: Customer

## Identity and Access Control

*For more information, see the [Azure Security Benchmark: Identity and Access Control](../security-control-identity-access-control).*

### 3.1: Maintain an inventory of administrative accounts

**Guidance**: While Azure Active Directory (Azure AD) is the recommended method to administrate user access, Azure Virtual Machines may have local accounts. Both local and domain accounts should be reviewed and managed, normally with a minimum footprint. In addition, leverage Azure Privileged Identity Management for administrative accounts used to access the virtual machines resources.

* [Information for Local Accounts is available at](/en-us/azure/active-directory/devices/assign-local-admin#manage-the-device-administrator-role)
* [Information on Privileged Identity Manager](/en-us/azure/active-directory/privileged-identity-management/pim-deployment-plan)

**Responsibility**: Customer

### 3.2: Change default passwords where applicable

**Guidance**: Linux Virtual Machines and Azure Active Directory (Azure AD) do not have the concept of default passwords. Customer responsible for third-party applications and marketplace services that may use default passwords.

**Responsibility**: Customer

### 3.3: Use dedicated administrative accounts

**Guidance**: Create standard operating procedures around the use of dedicated administrative accounts that have access to your virtual machines. Use Microsoft Defender for Cloud identity and access management to monitor the number of administrative accounts. Any administrator accounts used to access Azure Virtual Machine resources can also be managed by Azure Privileged Identity Management (PIM). Azure Privileged Identity Management provides several options such as Just in Time elevation, requiring multifactor authentication before assuming a role, and delegation options so that permissions are only available for specific time frames and require an approver.

* [Understand Microsoft Defender for Cloud Identity and Access](/en-us/azure/security-center/security-center-identity-access)
* [Information on Privileged Identity Manager](/en-us/azure/active-directory/privileged-identity-management/pim-deployment-plan)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Audit Windows machines missing any of specified members in the Administrators group](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F30f71ea1-ac77-4f26-9fc5-2d926bbd4ba7) | Requires that prerequisites are deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). Machines are non-compliant if the local Administrators group does not contain one or more members that are listed in the policy parameter. | auditIfNotExists | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_AdministratorsGroupMembersToInclude_AINE.json) |
| [Audit Windows machines that have extra accounts in the Administrators group](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F3d2a3320-2a72-4c67-ac5f-caa40fbee2b2) | Requires that prerequisites are deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). Machines are non-compliant if the local Administrators group contains members that are not listed in the policy parameter. | auditIfNotExists | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_AdministratorsGroupMembers_AINE.json) |
| [Audit Windows machines that have the specified members in the Administrators group](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F69bf4abd-ca1e-4cf6-8b5a-762d42e61d4f) | Requires that prerequisites are deployed to the policy assignment scope. For details, visit [https://aka.ms/gcpol](/en-us/azure/governance/policy/concepts/guest-configuration). Machines are non-compliant if the local Administrators group contains one or more of the members listed in the policy parameter. | auditIfNotExists | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Guest%20Configuration/GuestConfiguration_AdministratorsGroupMembersToExclude_AINE.json) |

### 3.4: Use Azure Active Directory single sign-on (SSO)

**Guidance**: Wherever possible, customer to use SSO with Azure Active Directory (Azure AD) rather than configuring individual stand-alone credentials per-service. Use Microsoft Defender for Cloud Identity and Access Management recommendations.

* [Understanding SSO with Azure AD](/en-us/azure/active-directory/manage-apps/what-is-single-sign-on)
* [How to monitor identity and access within Microsoft Defender for Cloud](/en-us/azure/security-center/security-center-identity-access)

**Responsibility**: Customer

### 3.5: Use multi-factor authentication for all Azure Active Directory-based access

**Guidance**: Enable Azure Active Directory (Azure AD) multifactor authentication and follow Microsoft Defender for Cloud Identity and Access Management recommendations.

* [How to enable multifactor authentication in Azure](/en-us/azure/active-directory/authentication/howto-mfa-getstarted)
* [How to monitor identity and access within Microsoft Defender for Cloud](/en-us/azure/security-center/security-center-identity-access)

**Responsibility**: Customer

### 3.6: Use secure, Azure-managed workstations for administrative tasks

**Guidance**: Use PAWs (privileged access workstations) with multifactor authentication configured to log into and configure Azure resources.

* [Learn about Privileged Access Workstations](/en-us/security/compass/overview)
* [How to enable multifactor authentication in Azure](/en-us/azure/active-directory/authentication/howto-mfa-getstarted)

**Responsibility**: Customer

### 3.7: Log and alert on suspicious activities from administrative accounts

**Guidance**: Use Azure Active Directory (Azure AD) Privileged Identity Management (PIM) for generation of logs and alerts when suspicious or unsafe activity occurs in the environment. Use Azure AD Risk Detections to view alerts and reports on risky user behavior. Optionally, customer may ingest Microsoft Defender for Cloud Risk Detection alerts into Azure Monitor and configure custom alerting/notifications using Action Groups.

* [How to deploy Privileged Identity Management (PIM)](/en-us/azure/active-directory/privileged-identity-management/pim-deployment-plan)
* [Understanding Microsoft Defender for Cloud risk detections (suspicious activity)](/en-us/azure/active-directory/identity-protection/overview-identity-protection)
* [How to integrate Azure Activity Logs into Azure Monitor](/en-us/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics)
* [How to configure action groups for custom alerting and notification](/en-us/azure/azure-monitor/alerts/action-groups)

**Responsibility**: Customer

### 3.8: Manage Azure resources from only approved locations

**Guidance**: Use Azure Active Directory (Azure AD) Conditional Access policies and named locations to allow access from only specific logical groupings of IP address ranges or countries/regions.

* [How to configure Named Locations in Azure](/en-us/azure/active-directory/reports-monitoring/quickstart-configure-named-locations)

**Responsibility**: Customer

### 3.9: Use Azure Active Directory

**Guidance**: Use Azure Active Directory (Azure AD) as the central authentication and authorization system. Azure AD protects data by using strong encryption for data at rest and in transit. Azure AD also salts, hashes, and securely stores user credentials. You can use managed identities to authenticate to any service that supports Azure AD authentication, including Key Vault, without any credentials in your code. Your code that's running on a virtual machine can use its managed identity to request access tokens for services that support Azure AD authentication.

* [How to create and configure an Azure AD instance](/en-us/azure/active-directory-domain-services/tutorial-create-instance)
* [Managed identities for Azure resources overview](/en-us/azure/active-directory/managed-identities-azure-resources/overview)

**Responsibility**: Customer

### 3.10: Regularly review and reconcile user access

**Guidance**: Azure Active Directory (Azure AD) provides logs to help discover stale accounts. In addition, use Azure AD identity access reviews to efficiently manage group memberships, access to enterprise applications, and role assignments. User's access can be reviewed on a regular basis to make sure only the right users have continued access. When using Azure Virtual machines, you will need to review the local security groups and users to make sure that there are no unexpected accounts which could compromise the system.

* [How to use Azure Identity Access Reviews](/en-us/azure/active-directory/governance/access-reviews-overview)

**Responsibility**: Customer

### 3.11: Monitor attempts to access deactivated credentials

**Guidance**: Configure diagnostic settings for Azure Active Directory (Azure AD) to send the audit logs and sign-in logs to a Log Analytics workspace. Also, use Azure Monitor to review logs and perform queries on auth syslog data from Azure Virtual machines.

* [Understand Log Analytics Workspace](/en-us/azure/azure-monitor/logs/log-analytics-tutorial)
* [How to integrate Azure Activity Logs into Azure Monitor](/en-us/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics)
* [How to perform custom queries in Azure Monitor](/en-us/azure/azure-monitor/logs/get-started-queries)
* [Syslog data sources in Azure Monitor](/en-us/azure/azure-monitor/agents/data-sources-syslog)

**Responsibility**: Customer

### 3.12: Alert on account sign-in behavior deviation

**Guidance**: Use Azure Active Directory (Azure AD)'s Risk and Identity Protection features to configure automated responses to detected suspicious actions related to your storage account resources. You should enable automated responses through Microsoft Sentinel to implement your organization's security responses.

* [How to view Azure AD risky sign-ins](/en-us/azure/active-directory/identity-protection/overview-identity-protection)
* [How to configure and enable Identity Protection risk policies](/en-us/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies)
* [How to onboard Microsoft Sentinel](/en-us/azure/sentinel/quickstart-onboard)

**Responsibility**: Customer

### 3.13: Provide Microsoft with access to relevant customer data during support scenarios

**Guidance**: In cases where a third party needs to access customer data (such as during a support request), use Customer Lockbox for Azure virtual machines to review and approve or reject customer data access requests.

* [Customer Lockbox for Microsoft Azure](/en-us/azure/security/fundamentals/customer-lockbox-overview)

**Responsibility**: Customer

## Data Protection

*For more information, see the [Azure Security Benchmark: Data Protection](../security-control-data-protection).*

### 4.1: Maintain an inventory of sensitive Information

**Guidance**: Use Tags to assist in tracking Azure virtual machines that store or process sensitive information.

* [How to create and use Tags](/en-us/azure/azure-resource-manager/management/tag-resources)

**Responsibility**: Customer

### 4.2: Isolate systems storing or processing sensitive information

**Guidance**: Implement separate subscriptions and/or management groups for development, test, and production. Resources should be separated by virtual network/subnet, tagged appropriately, and secured within a network security group (NSG) or by an Azure Firewall. For Virtual Machines storing or processing sensitive data, implement policy and procedure(s) to turn them off when not in use.

* [How to create additional Azure subscriptions](/en-us/azure/cost-management-billing/manage/create-subscription)
* [How to create Management Groups](/en-us/azure/governance/management-groups/create-management-group-portal)
* [How to create and use Tags](/en-us/azure/azure-resource-manager/management/tag-resources)
* [How to create a Virtual Network](/en-us/azure/virtual-network/quick-create-portal)
* [How to create an NSG with a Security Config](/en-us/azure/virtual-network/tutorial-filter-network-traffic)
* [How to deploy Azure Firewall](/en-us/azure/firewall/tutorial-firewall-deploy-portal)
* [How to configure alert or alert and deny with Azure Firewall](/en-us/azure/firewall/threat-intel)

**Responsibility**: Customer

### 4.3: Monitor and block unauthorized transfer of sensitive information

**Guidance**: Implement third-party solution on network perimeters that monitors for unauthorized transfer of sensitive information and blocks such transfers while alerting information security professionals.

For the underlying platform which is managed by Microsoft, Microsoft treats all customer content as sensitive to guard against customer data loss and exposure. To ensure customer data within Azure remains secure, Microsoft has implemented and maintains a suite of robust data protection controls and capabilities.

* [Understand customer data protection in Azure](/en-us/azure/security/fundamentals/protection-customer-data)

**Responsibility**: Customer

### 4.4: Encrypt all sensitive information in transit

**Guidance**: Data in transit to, from, and between Virtual Machines (VM) that are running Linux is encrypted in a number of ways, depending on the nature of the connection such as when connecting to a VM in an RDP or SSH session.

Microsoft uses the Transport Layer Security (TLS) protocol to protect data when it's traveling between the cloud services and customers.

* [In-transit encryption in VMs](/en-us/azure/security/fundamentals/encryption-overview#in-transit-encryption-in-vms)

**Responsibility**: Shared

### 4.5: Use an active discovery tool to identify sensitive data

**Guidance**: Use a third-party active discovery tool to identify all sensitive information stored, processed, or transmitted by the organization's technology systems, including those located onsite or at a remote service provider and update the organization's sensitive information inventory.

**Responsibility**: Customer

### 4.6: Use Azure RBAC to control access to resources

**Guidance**: Using Azure role-based access control (Azure RBAC), you can segregate duties within your team and grant only the amount of access to users on your VM that they need to perform their jobs. Instead of giving everybody unrestricted permissions on the VM, you can allow only certain actions. You can configure access control for the VM in the Azure portal, using the Azure CLI, or Azure PowerShell.

* [Azure RBAC](/en-us/azure/role-based-access-control/overview)
* [Azure built-in roles](/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-contributor)

**Responsibility**: Customer

### 4.7: Use host-based data loss prevention to enforce access control

**Guidance**: Implement a third-party tool, such as an automated host-based Data Loss Prevention solution, to enforce access controls to mitigate the risk of data breaches.

**Responsibility**: Customer

### 4.8: Encrypt sensitive information at rest

**Guidance**: Virtual disks on Linux Virtual Machines(VM) are encrypted at rest using either Server-side encryption or Azure disk encryption (ADE). Azure Disk Encryption leverages the DM-Crypt feature of Linux to encrypt managed disks with customer-managed keys within the guest VM. Server-side encryption with customer-managed keys improves on ADE by enabling you to use any OS types and images for your VMs by encrypting data in the Storage service.

* [Server side encryption of Azure managed disks](/en-us/azure/virtual-machines/disk-encryption)
* [Azure Disk Encryption for Linux VMs](/en-us/azure/virtual-machines/linux/disk-encryption-overview)

**Responsibility**: Shared

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Virtual machines should encrypt temp disks, caches, and data flows between Compute and Storage resources](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F0961003e-5a0a-4549-abde-af6a37f2724d) | Virtual machines without an enabled disk encryption will be monitored by Microsoft Defender for Cloud as recommendations. | AuditIfNotExists, Disabled | [2.0.1](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_UnencryptedVMDisks_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Unattached disks should be encrypted](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F2c89a2e5-7285-40fe-afe0-ae8654b92fb2) | This policy audits any unattached disk without encryption enabled. | Audit, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Compute/UnattachedDisk_Encryption_Audit.json) |
| [Virtual machines should encrypt temp disks, caches, and data flows between Compute and Storage resources](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F0961003e-5a0a-4549-abde-af6a37f2724d) | Virtual machines without an enabled disk encryption will be monitored by Microsoft Defender for Cloud as recommendations. | AuditIfNotExists, Disabled | [2.0.1](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_UnencryptedVMDisks_Audit.json) |

### 4.9: Log and alert on changes to critical Azure resources

**Guidance**: Use Azure Monitor with the Azure Activity Log to create alerts for when changes take place to Virtual machines and related resources.

* [How to create alerts for Azure Activity Log events](/en-us/azure/azure-monitor/alerts/alerts-activity-log)
* [Azure Storage analytics logging](/en-us/azure/storage/common/storage-analytics-logging)

**Responsibility**: Customer

## Vulnerability Management

*For more information, see the [Azure Security Benchmark: Vulnerability Management](../security-control-vulnerability-management).*

### 5.1: Run automated vulnerability scanning tools

**Guidance**: You will need a third-party tool for anti-malware vulnerability detection for inside the Linux OS.

* [Instructions for onboarding Linux servers to Microsoft Defender for Cloud](/en-us/azure/security-center/quickstart-onboard-machines)
* [Microsoft recommended security guidelines](/en-us/azure/virtual-machines/linux/security-recommendations)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [A vulnerability assessment solution should be enabled on your virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F501541f7-f7e7-4cd6-868c-4190fdad3ac9) | Audits virtual machines to detect whether they are running a supported vulnerability assessment solution. A core component of every cyber risk and security program is the identification and analysis of vulnerabilities. Microsoft Defender for Cloud's standard pricing tier includes vulnerability scanning for your virtual machines at no extra cost. Additionally, Security Center can automatically deploy this tool for you. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ServerVulnerabilityAssessment_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [A vulnerability assessment solution should be enabled on your virtual machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F501541f7-f7e7-4cd6-868c-4190fdad3ac9) | Audits virtual machines to detect whether they are running a supported vulnerability assessment solution. A core component of every cyber risk and security program is the identification and analysis of vulnerabilities. Microsoft Defender for Cloud's standard pricing tier includes vulnerability scanning for your virtual machines at no extra cost. Additionally, Security Center can automatically deploy this tool for you. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ServerVulnerabilityAssessment_Audit.json) |

### 5.2: Deploy automated operating system patch management solution

**Guidance**: Use the Azure Update Management solution to manage updates and patches for your virtual machines. Update Management relies on the locally configured update repository to patch supported systems.

* [Update Management solution in Azure](/en-us/azure/automation/overview)
* [Manage updates and patches for your Azure VMs](/en-us/azure/automation/update-management/manage-updates-for-vm)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [System updates should be installed on your machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F86b3d65f-7626-441e-b690-81a8b71cff60) | Missing security system updates on your servers will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [4.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_MissingSystemUpdates_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [System updates on virtual machine scale sets should be installed](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fc3f317a7-a95c-4547-b7e7-11017ebdf2fe) | Audit whether there are any missing system security updates and critical updates that should be installed to ensure that your Windows and Linux virtual machine scale sets are secure. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_VmssMissingSystemUpdates_Audit.json) |
| [System updates should be installed on your machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F86b3d65f-7626-441e-b690-81a8b71cff60) | Missing security system updates on your servers will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [4.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_MissingSystemUpdates_Audit.json) |

### 5.3: Deploy automated patch management solution for third-party software titles

**Guidance**: You may use a third-party patch management solution. You can use the Azure Update Management solution to manage updates and patches for your virtual machines. Update Management relies on the locally configured update repository to patch supported systems.

* [Update Management solution in Azure](/en-us/azure/automation/overview)
* [Manage updates and patches for your Azure VMs](/en-us/azure/automation/update-management/manage-updates-for-vm)

**Responsibility**: Customer

### 5.4: Compare back-to-back vulnerability scans

**Guidance**: Export scan results at consistent intervals and compare the results to verify that vulnerabilities have been remediated. When using vulnerability management recommendation suggested by Microsoft Defender for Cloud, customer may pivot into the selected solution's portal to view historical scan data.

**Responsibility**: Customer

### 5.5: Use a risk-rating process to prioritize the remediation of discovered vulnerabilities

**Guidance**: Use the default risk ratings (Secure Score) provided by Microsoft Defender for Cloud.

* [Understand Microsoft Defender for Cloud Secure Score](/en-us/azure/security-center/secure-score-security-controls)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Vulnerabilities in container security configurations should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe8cbc669-f12d-49eb-93e7-9273119e9933) | Audit vulnerabilities in security configuration on machines with Docker installed and display as recommendations in Microsoft Defender for Cloud. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ContainerBenchmark_Audit.json) |
| [Vulnerabilities in security configuration on your machines should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15) | Servers which do not satisfy the configured baseline will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_OSVulnerabilities_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Vulnerabilities in container security configurations should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe8cbc669-f12d-49eb-93e7-9273119e9933) | Audit vulnerabilities in security configuration on machines with Docker installed and display as recommendations in Microsoft Defender for Cloud. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ContainerBenchmark_Audit.json) |
| [Vulnerabilities in security configuration on your machines should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15) | Servers which do not satisfy the configured baseline will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_OSVulnerabilities_Audit.json) |
| [Vulnerabilities in security configuration on your virtual machine scale sets should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F3c735d8a-a4ba-4a3a-b7cf-db7754cf57f4) | Audit the OS vulnerabilities on your virtual machine scale sets to protect them from attacks. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_VmssOSVulnerabilities_Audit.json) |

## Inventory and Asset Management

*For more information, see the [Azure Security Benchmark: Inventory and Asset Management](../security-control-inventory-asset-management).*

### 6.1: Use automated asset discovery solution

**Guidance**: Use Azure Resource Graph to query and discover all resources (including virtual machines) within your subscriptions. Ensure you have appropriate (read) permissions in your tenant and are able to enumerate all Azure subscriptions as well as resources within your subscriptions.

* [How to create queries with Azure Graph](/en-us/azure/governance/resource-graph/first-query-portal)
* [How to view your Azure Subscriptions](/en-us/powershell/module/az.accounts/get-azsubscription)
* [Understand Azure RBAC](/en-us/azure/role-based-access-control/overview)

**Responsibility**: Customer

### 6.2: Maintain asset metadata

**Guidance**: Apply tags to Azure resources giving metadata to logically organize them according to a taxonomy.

* [How to create and use Tags](/en-us/azure/azure-resource-manager/management/tag-resources)

**Responsibility**: Customer

### 6.3: Delete unauthorized Azure resources

**Guidance**: Use tagging, management groups, and separate subscriptions, where appropriate, to organize and track virtual machines and related resources. Reconcile inventory on a regular basis and ensure unauthorized resources are deleted from the subscription in a timely manner.

* [How to create additional Azure subscriptions](/en-us/azure/cost-management-billing/manage/create-subscription)
* [How to create Management Groups](/en-us/azure/governance/management-groups/create-management-group-portal)
* [How to create and use Tags](/en-us/azure/azure-resource-manager/management/tag-resources)

**Responsibility**: Customer

### 6.4: Define and maintain inventory of approved Azure resources

**Guidance**: You should create an inventory of approved Azure resources and approved software for your compute resources. You can also use Adaptive application controls, a feature of Microsoft Defender for Cloud to help you define a set of applications that are allowed to run on configured groups of machines. This feature is available for both Azure and non-Azure Windows (all versions, classic, or Azure Resource Manager) and Linux machines.

* [How to enable Adaptive Application Control](/en-us/azure/security-center/security-center-adaptive-application)

**Responsibility**: Customer

### 6.5: Monitor for unapproved Azure resources

**Guidance**: Use Azure policy to put restrictions on the type of resources that can be created in customer subscription(s) using the following built-in policy definitions:

* Not allowed resource types
* Allowed resource types

In addition, use the Azure Resource Graph to query/discover resources within the subscription(s). This can help in high security-based environments, such as those with Storage accounts.

* [How to configure and manage Azure Policy](/en-us/azure/governance/policy/tutorials/create-and-manage)
* [How to create queries with Azure Graph](/en-us/azure/governance/resource-graph/first-query-portal)

**Responsibility**: Customer

### 6.6: Monitor for unapproved software applications within compute resources

**Guidance**: Azure Automation provides complete control during deployment, operations, and decommissioning of workloads and resources. Leverage Azure Virtual Machine Inventory to automate the collection of information about all software on Virtual Machines. Note: Software Name, Version, Publisher, and Refresh time are available from the Azure portal. To get access to metrics and other information, customer required to enable guest-level diagnostic and can send syslog information to a designated storage account.

In addition to using Change Tracking for monitoring of software applications, adaptive application controls in Microsoft Defender for Cloud use machine learning to analyze the applications running on your machines and create an allowlist from this intelligence. This capability greatly simplifies the process of configuring and maintaining application allowlist policies, enabling you to Avoid unwanted software to be used in your environment. You can configure audit mode or enforce mode. Audit mode only audits the activity on the protected VMs. Enforce mode does enforce the rules, and makes sure that applications that are not allowed to run are blocked.

* [Diagnostic extension for Linux virtual machines](/en-us/azure/virtual-machines/extensions/diagnostics-linux)
* [An introduction to Azure Automation](/en-us/azure/automation/automation-intro)
* [How to enable Azure VM Inventory](/en-us/azure/automation/automation-tutorial-installed-software)
* [Understand adaptive application controls](/en-us/azure/security-center/security-center-adaptive-application)

**Responsibility**: Customer

### 6.7: Remove unapproved Azure resources and software applications

**Guidance**: Azure Automation provides complete control during deployment, operations, and decommissioning of workloads and resources. You may use Change Tracking to identify all software installed on Virtual Machines. You can implement your own process or use Azure Automation State Configuration for removing unauthorized software.

* [An introduction to Azure Automation](/en-us/azure/automation/automation-intro)
* [Understanding Change Tracking](/en-us/azure/automation/change-tracking/overview)

**Responsibility**: Customer

### 6.8: Use only approved applications

**Guidance**: Use Microsoft Defender for Cloud Adaptive Application Controls to ensure that only authorized software executes and all unauthorized software is blocked from executing on Azure Virtual Machines.

* [How to use Microsoft Defender for Cloud Adaptive Application Controls](/en-us/azure/security-center/security-center-adaptive-application)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Adaptive application controls for defining safe applications should be enabled on your machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F47a6b606-51aa-4496-8bb7-64b11cf66adc) | Enable application controls to define the list of known-safe applications running on your machines, and alert you when other applications run. This helps harden your machines against malware. To simplify the process of configuring and maintaining your rules, Security Center uses machine learning to analyze the applications running on each machine and suggest the list of known-safe applications. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_AdaptiveApplicationControls_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Adaptive application controls for defining safe applications should be enabled on your machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F47a6b606-51aa-4496-8bb7-64b11cf66adc) | Enable application controls to define the list of known-safe applications running on your machines, and alert you when other applications run. This helps harden your machines against malware. To simplify the process of configuring and maintaining your rules, Security Center uses machine learning to analyze the applications running on each machine and suggest the list of known-safe applications. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_AdaptiveApplicationControls_Audit.json) |

### 6.9: Use only approved Azure services

**Guidance**: Use Azure policy to put restrictions on the type of resources that can be created in customer subscription(s) using the following built-in policy definitions:

* Not allowed resource types
* Allowed resource types

For more information, see the following references:

* [How to configure and manage Azure Policy](/en-us/azure/governance/policy/tutorials/create-and-manage)
* [How to deny a specific resource type with Azure Policy](/en-us/azure/governance/policy/samples)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Virtual machines should be migrated to new Azure Resource Manager resources](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F1d84d5fb-01f6-4d12-ba4f-4a26081d403d) | Use new Azure Resource Manager for your virtual machines to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management | Audit, Deny, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Compute/ClassicCompute_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Virtual machines should be migrated to new Azure Resource Manager resources](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F1d84d5fb-01f6-4d12-ba4f-4a26081d403d) | Use new Azure Resource Manager for your virtual machines to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management | Audit, Deny, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Compute/ClassicCompute_Audit.json) |

### 6.10: Maintain an inventory of approved software titles

**Guidance**: Adaptive application control is an intelligent, automated, end-to-end solution from Microsoft Defender for Cloud which helps you control which applications can run on your Azure and non-Azure machines (Windows and Linux). Implement third-party solution if this does not meet your organization's requirement.

* [How to use Microsoft Defender for Cloud Adaptive Application Controls](/en-us/azure/security-center/security-center-adaptive-application)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Adaptive application controls for defining safe applications should be enabled on your machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F47a6b606-51aa-4496-8bb7-64b11cf66adc) | Enable application controls to define the list of known-safe applications running on your machines, and alert you when other applications run. This helps harden your machines against malware. To simplify the process of configuring and maintaining your rules, Security Center uses machine learning to analyze the applications running on each machine and suggest the list of known-safe applications. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_AdaptiveApplicationControls_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Adaptive application controls for defining safe applications should be enabled on your machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F47a6b606-51aa-4496-8bb7-64b11cf66adc) | Enable application controls to define the list of known-safe applications running on your machines, and alert you when other applications run. This helps harden your machines against malware. To simplify the process of configuring and maintaining your rules, Security Center uses machine learning to analyze the applications running on each machine and suggest the list of known-safe applications. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_AdaptiveApplicationControls_Audit.json) |

### 6.11: Limit users' ability to interact with Azure Resource Manager

**Guidance**: Use Azure Conditional Access to limit users' ability to interact with Azure Resource Manager by configuring "Block access" for the "Microsoft Azure Management" App.

* [How to configure Conditional Access to block access to Azure Resource Manager](/en-us/azure/role-based-access-control/conditional-access-azure-management)

**Responsibility**: Customer

### 6.12: Limit users' ability to execute scripts within compute resources

**Guidance**: Depending on the type of scripts, you may use operating system-specific configurations or third-party resources to limit users' ability to execute scripts within Azure compute resources. You can also leverage Microsoft Defender for Cloud Adaptive Application Controls to ensure that only authorized software executes and all unauthorized software is blocked from executing on Azure Virtual Machines.

* [How to use Microsoft Defender for Cloud Adaptive Application Controls](/en-us/azure/security-center/security-center-adaptive-application)

**Responsibility**: Customer

### 6.13: Physically or logically segregate high risk applications

**Guidance**: High risk applications deployed in your Azure environment may be isolated using virtual networks, subnets, subscriptions, management groups and sufficiently secured with either an Azure Firewall, Web Application Firewall (WAF) or network security group (NSG).

* [Virtual networks and virtual machines in Azure](/en-us/azure/virtual-machines/network-overview)
* [Azure Firewall overview](/en-us/azure/firewall/overview)
* [Web Application Firewall overview](/en-us/azure/web-application-firewall/overview)
* [Network security overview](/en-us/azure/virtual-network/network-security-groups-overview)
* [Azure Virtual Network overview](/en-us/azure/virtual-network/virtual-networks-overview)
* [Organize your resources with Azure management groups](/en-us/azure/governance/management-groups/overview)
* [Subscription decision guide](/en-us/azure/cloud-adoption-framework/decision-guides/subscriptions/)

**Responsibility**: Customer

## Secure Configuration

*For more information, see the [Azure Security Benchmark: Secure Configuration](../security-control-secure-configuration).*

### 7.1: Establish secure configurations for all Azure resources

**Guidance**: Use Azure Policy or Microsoft Defender for Cloud to maintain security configurations for all Azure resources. Also, Azure Resource Manager has the ability to export the template in JavaScript Object Notation (JSON), which should be reviewed to ensure that the configurations meet / exceed the security requirements for your company.

* [How to configure and manage Azure Policy](/en-us/azure/governance/policy/tutorials/create-and-manage)
* [Information on how to download the VM template](/en-us/previous-versions/azure/virtual-machines/windows/download-template)

**Responsibility**: Customer

### 7.2: Establish secure operating system configurations

**Guidance**: Use Microsoft Defender for Cloud recommendation [Remediate Vulnerabilities in Security Configurations on your Virtual Machines] to maintain security configurations on all compute resources.

* [How to monitor Microsoft Defender for Cloud recommendations](/en-us/azure/security-center/security-center-recommendations)
* [How to remediate Microsoft Defender for Cloud recommendations](/en-us/azure/security-center/security-center-remediate-recommendations)

**Responsibility**: Customer

### 7.3: Maintain secure Azure resource configurations

**Guidance**: Use Azure Resource Manager templates and Azure Policies to securely configure Azure resources associated with the Virtual machines. Azure Resource Manager templates are JSON-based files used to deploy Virtual machine along with Azure resources and custom template will need to be maintained. Microsoft performs the maintenance on the base templates. Use Azure policy [deny] and [deploy if not exist] to enforce secure settings across your Azure resources.

* [Information on creating Azure Resource Manager templates](/en-us/azure/virtual-machines/windows/ps-template)
* [How to configure and manage Azure Policy](/en-us/azure/governance/policy/tutorials/create-and-manage)
* [Understanding Azure Policy Effects](/en-us/azure/governance/policy/concepts/effects)

**Responsibility**: Customer

### 7.4: Maintain secure operating system configurations

**Guidance**: There are several options for maintaining a secure configuration for Azure Virtual Machines(VM) for deployment:

1- Azure Resource Manager templates: These are JSON-based files used to deploy a VM from the Azure portal, and custom template will need to be maintained. Microsoft performs the maintenance on the base templates.

2- Custom Virtual hard disk (VHD): In some circumstances it may be required to have custom VHD files used such as when dealing with complex environments that cannot be managed through other means.

3- Azure Automation State Configuration: Once the base OS is deployed, this can be used for more granular control of the settings, and enforced through the automation framework.

For most scenarios, the Microsoft base VM templates combined with the Azure Automation Desired State Configuration can assist in meeting and maintaining the security requirements.

* [Information on how to download the VM template](/en-us/previous-versions/azure/virtual-machines/windows/download-template)
* [Information on creating ARM templates](/en-us/azure/virtual-machines/windows/ps-template)
* [How to upload a custom VM VHD to Azure](/en-us/azure/virtual-machines/windows/upload-generalized-managed)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Vulnerabilities in container security configurations should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe8cbc669-f12d-49eb-93e7-9273119e9933) | Audit vulnerabilities in security configuration on machines with Docker installed and display as recommendations in Microsoft Defender for Cloud. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ContainerBenchmark_Audit.json) |
| [Vulnerabilities in security configuration on your machines should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15) | Servers which do not satisfy the configured baseline will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_OSVulnerabilities_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Vulnerabilities in container security configurations should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe8cbc669-f12d-49eb-93e7-9273119e9933) | Audit vulnerabilities in security configuration on machines with Docker installed and display as recommendations in Microsoft Defender for Cloud. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ContainerBenchmark_Audit.json) |
| [Vulnerabilities in security configuration on your machines should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15) | Servers which do not satisfy the configured baseline will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_OSVulnerabilities_Audit.json) |
| [Vulnerabilities in security configuration on your virtual machine scale sets should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F3c735d8a-a4ba-4a3a-b7cf-db7754cf57f4) | Audit the OS vulnerabilities on your virtual machine scale sets to protect them from attacks. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_VmssOSVulnerabilities_Audit.json) |

### 7.5: Securely store configuration of Azure resources

**Guidance**: Use Azure Repos to securely store and manage your code like custom Azure Policy definitions, Azure Resource Manager templates, Desired State Configuration scripts, and other code. To access the resources you manage in Azure DevOps, such as your code, builds, and work tracking, you must have permissions for those specific resources. Most permissions are granted through built-in security groups as described in Permissions and access. You can grant or deny permissions to specific users, built-in security groups, or groups defined in Azure Active Directory (Azure AD) if integrated with Azure DevOps, or Active Directory if integrated with TFS.

* [How to store code in Azure DevOps](/en-us/azure/devops/repos/git/gitworkflow)
* [About permissions and groups in Azure DevOps](/en-us/azure/devops/organizations/security/about-permissions)

**Responsibility**: Customer

### 7.6: Securely store custom operating system images

**Guidance**: If using custom images (e.g. Virtual Hard Disk), use Azure RBAC to ensure only authorized users may access the images.

* [Understand Azure RBAC](/en-us/azure/role-based-access-control/rbac-and-directory-admin-roles)
* [How to configure Azure RBAC](/en-us/azure/role-based-access-control/quickstart-assign-role-user-portal)

**Responsibility**: Customer

### 7.7: Deploy configuration management tools for Azure resources

**Guidance**: Leverage Azure Policy to alert, audit, and enforce system configurations for your virtual machines. Additionally, develop a process and pipeline for managing policy exceptions.

* [How to configure and manage Azure policy](/en-us/azure/governance/policy/tutorials/create-and-manage)

**Responsibility**: Customer

### 7.8: Deploy configuration management tools for operating systems

**Guidance**: Azure Automation State Configuration is a configuration management service for Desired State Configuration (DSC) nodes in any cloud or on-premises datacenter. It enables scalability across thousands of machines quickly and easily from a central, secure location. You can easily onboard machines, assign them declarative configurations, and view reports showing each machine's compliance with the desired state you specified.

* [Onboarding machines for management by Azure Automation State Configuration](/en-us/azure/automation/automation-dsc-onboarding)

**Responsibility**: Customer

### 7.9: Implement automated configuration monitoring for Azure resources

**Guidance**: Leverage Microsoft Defender for Cloud to perform baseline scans for your Azure Virtual machines. Additional methods for automated configuration include using Azure Automation State Configuration.

* [How to remediate recommendations in Microsoft Defender for Cloud](/en-us/azure/security-center/security-center-remediate-recommendations)
* [Getting started with Azure Automation State Configuration](/en-us/azure/automation/automation-dsc-getting-started)

**Responsibility**: Customer

### 7.10: Implement automated configuration monitoring for operating systems

**Guidance**: Azure Automation State Configuration is a configuration management service for Desired State Configuration (DSC) nodes in any cloud or on-premises datacenter. It enables scalability across thousands of machines quickly and easily from a central, secure location. You can easily onboard machines, assign them declarative configurations, and view reports showing each machine's compliance with the desired state you specified.

* [Onboarding machines for management by Azure Automation State Configuration](/en-us/azure/automation/automation-dsc-onboarding)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Vulnerabilities in container security configurations should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe8cbc669-f12d-49eb-93e7-9273119e9933) | Audit vulnerabilities in security configuration on machines with Docker installed and display as recommendations in Microsoft Defender for Cloud. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ContainerBenchmark_Audit.json) |
| [Vulnerabilities in security configuration on your machines should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15) | Servers which do not satisfy the configured baseline will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_OSVulnerabilities_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Vulnerabilities in container security configurations should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe8cbc669-f12d-49eb-93e7-9273119e9933) | Audit vulnerabilities in security configuration on machines with Docker installed and display as recommendations in Microsoft Defender for Cloud. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ContainerBenchmark_Audit.json) |
| [Vulnerabilities in security configuration on your machines should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fe1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15) | Servers which do not satisfy the configured baseline will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_OSVulnerabilities_Audit.json) |
| [Vulnerabilities in security configuration on your virtual machine scale sets should be remediated](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F3c735d8a-a4ba-4a3a-b7cf-db7754cf57f4) | Audit the OS vulnerabilities on your virtual machine scale sets to protect them from attacks. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_VmssOSVulnerabilities_Audit.json) |

### 7.11: Manage Azure secrets securely

**Guidance**: Use Managed Service Identity in conjunction with Azure Key Vault to simplify and secure secret management for your cloud applications.

* [How to integrate with Azure Managed Identities](/en-us/azure/azure-app-configuration/howto-integrate-azure-managed-service-identity)
* [How to create a Key Vault](/en-us/azure/key-vault/general/quick-create-portal)
* [How to authenticate to Key Vault](/en-us/azure/key-vault/general/authentication)
* [How to assign a Key Vault access policy](/en-us/azure/key-vault/general/assign-access-policy-portal)

**Responsibility**: Customer

### 7.12: Manage identities securely and automatically

**Guidance**: Use Managed Identities to provide Azure services with an automatically managed identity in Azure Active Directory (Azure AD). Managed Identities allows you to authenticate to any service that supports Azure AD authentication, including Key Vault, without any credentials in your code.

* [How to configure Managed Identities](/en-us/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm)

**Responsibility**: Customer

### 7.13: Eliminate unintended credential exposure

**Guidance**: Implement Credential Scanner to identify credentials within code. Credential Scanner will also encourage moving discovered credentials to more secure locations such as Azure Key Vault.

* [How to setup Credential Scanner](https://secdevtools.azurewebsites.net/helpcredscan.html)

**Responsibility**: Customer

## Malware Defense

*For more information, see the [Azure Security Benchmark: Malware Defense](../security-control-malware-defense).*

### 8.1: Use centrally-managed anti-malware software

**Guidance**: You will need a third-party tool for anti-malware protection in Azure Linux Virtual machine.

* [How to configure Microsoft Antimalware for Cloud Services and Virtual Machines](/en-us/azure/virtual-machines/linux/security-recommendations)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.ClassicCompute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Monitor missing Endpoint Protection in Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Faf6cd1bd-1635-48cb-bde7-5b15693900b9) | Servers without an installed Endpoint Protection agent will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_MissingEndpointProtection_Audit.json) |

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Endpoint protection solution should be installed on virtual machine scale sets](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F26a828e1-e88f-464e-bbb3-c134a282b9de) | Audit the existence and health of an endpoint protection solution on your virtual machines scale sets, to protect them from threats and vulnerabilities. | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_VmssMissingEndpointProtection_Audit.json) |
| [Monitor missing Endpoint Protection in Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Faf6cd1bd-1635-48cb-bde7-5b15693900b9) | Servers without an installed Endpoint Protection agent will be monitored by Microsoft Defender for Cloud as recommendations | AuditIfNotExists, Disabled | [3.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_MissingEndpointProtection_Audit.json) |

### 8.3: Ensure anti-malware software and signatures are updated

**Guidance**: You will need a third-party tool for anti-malware protection in Azure Linux Virtual machine.

* [How to configure Microsoft Antimalware for Cloud Services and Virtual Machines](/en-us/azure/virtual-machines/linux/security-recommendations)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Microsoft Antimalware for Azure should be configured to automatically update protection signatures](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2Fc43e4a30-77cb-48ab-a4dd-93f175c63b57) | This policy audits any Windows virtual machine not configured with automatic update of Microsoft Antimalware protection signatures. | AuditIfNotExists, Disabled | [1.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Compute/VirtualMachines_AntiMalwareAutoUpdate_AuditIfNotExists.json) |

## Data Recovery

*For more information, see the [Azure Security Benchmark: Data Recovery](../security-control-data-recovery).*

### 9.1: Ensure regular automated back-ups

**Guidance**: Enable Azure Backup and configure the Azure Virtual machines (VM), as well as the desired frequency and retention period for automatic backups.

* [An overview of Azure VM backup](/en-us/azure/backup/backup-azure-vms-introduction)
* [Back up an Azure VM from the VM settings](/en-us/azure/backup/backup-azure-vms-first-look-arm)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Azure Backup should be enabled for Virtual Machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F013e242c-8828-4970-87b3-ab247555486d) | Ensure protection of your Azure Virtual Machines by enabling Azure Backup. Azure Backup is a secure and cost effective data protection solution for Azure. | AuditIfNotExists, Disabled | [2.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Backup/VirtualMachines_EnableAzureBackup_Audit.json) |

### 9.2: Perform complete system backups and backup any customer-managed keys

**Guidance**: Create snapshots of your Azure virtual machines or the managed disks attached to those instances using PowerShell or REST APIs. Back up any customer-managed keys within Azure Key Vault.

Enable Azure Backup and target Azure Virtual Machines (VM), as well as the desired frequency and retention periods. This includes complete system state backup. If you are using Azure disk encryption, Azure VM backup automatically handles the backup of customer-managed keys.

* [Backup on Azure VMs that use encryption](/en-us/azure/backup/backup-azure-vms-encryption)
* [Overview of Azure VM backup](/en-us/azure/backup/backup-azure-vms-introduction)
* [Understand how automatic backups work](/en-us/azure/backup/backup-azure-vms-encryption)
* [How to backup key vault keys in Azure](/en-us/powershell/module/az.keyvault/backup-azkeyvaultkey)

**Responsibility**: Customer

**Microsoft Defender for Cloud monitoring**: The [Azure Security Benchmark](/en-us/azure/governance/policy/samples/azure-security-benchmark) is the default policy initiative for Microsoft Defender for Cloud and is the foundation for [Microsoft Defender for Cloud's recommendations](/en-us/azure/security-center/security-center-recommendations). The Azure Policy definitions related to this control are enabled automatically by Microsoft Defender for Cloud. Alerts related to this control may require a [Microsoft Defender](/en-us/azure/security-center/azure-defender) plan for the related services.

**Azure Policy built-in definitions - Microsoft.Compute**:

| Name(Azure portal) | Description | Effect(s) | Version(GitHub) |
| --- | --- | --- | --- |
| [Azure Backup should be enabled for Virtual Machines](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F013e242c-8828-4970-87b3-ab247555486d) | Ensure protection of your Azure Virtual Machines by enabling Azure Backup. Azure Backup is a secure and cost effective data protection solution for Azure. | AuditIfNotExists, Disabled | [2.0.0](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Backup/VirtualMachines_EnableAzureBackup_Audit.json) |

### 9.3: Validate all backups including customer-managed keys

**Guidance**: Ensure ability to periodically perform data restoration of content within Azure Backup. If necessary, test restoring content to an isolated virtual network or subscription. Customer to test restoration of backed up customer-managed keys.

If you are using Azure disk encryption, you can restore the Azure VM with the disk encryption keys. When using disk encryption, you can restore the Azure VM with the disk encryption keys.

* [Backup on Azure VMs that use encryption](/en-us/azure/backup/backup-azure-vms-encryption)
* [How to recover files from Azure Virtual Machine backup](/en-us/azure/backup/backup-azure-restore-files-from-vm)
* [How to restore key vault keys in Azure](/en-us/powershell/module/az.keyvault/restore-azkeyvaultkey)
* [How to back up and restore an encrypted VM](/en-us/azure/backup/backup-azure-vms-encryption)

**Responsibility**: Customer

### 9.4: Ensure protection of backups and customer-managed keys

**Guidance**: When you back up Azure VMs with Azure Backup, VMs are encrypted at rest with Storage Service Encryption (SSE). Azure Backup can also back up Azure VMs that are encrypted by using Azure Disk Encryption. Azure Disk Encryption also integrates with Azure Key Vault key encryption keys (KEKs). Enable Soft-Delete in Key Vault to protect keys against accidental or malicious deletion.

* [Soft delete for VMs](/en-us/azure/backup/soft-delete-virtual-machines)
* [Azure Key Vault soft-delete overview](/en-us/azure/key-vault/general/soft-delete-overview)

**Responsibility**: Customer

## Incident Response

*For more information, see the [Azure Security Benchmark: Incident Response](../security-control-incident-response).*

### 10.1: Create an incident response guide

**Guidance**: Build out an incident response guide for your organization. Ensure that there are written incident response plans that define all roles of personnel as well as phases of incident handling/management from detection to post-incident review.

* [Guidance on building your own security incident response process](https://msrc-blog.microsoft.com/2019/07/01/inside-the-msrc-building-your-own-security-incident-response-process/)
* [Microsoft Security Response Center's Anatomy of an Incident](https://msrc-blog.microsoft.com/2019/06/27/inside-the-msrc-anatomy-of-a-ssirp-incident/)
* [Customer may also leverage NIST's Computer Security Incident Handling Guide to aid in the creation of their own incident response plan](https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final)

**Responsibility**: Customer

### 10.2: Create an incident scoring and prioritization procedure

**Guidance**: Microsoft Defender for Cloud assigns a severity to each alert to help you prioritize which alerts should be investigated first. The severity is based on how confident Microsoft Defender for Cloud is in the finding or the analytics used to issue the alert as well as the confidence level that there was malicious intent behind the activity that led to the alert. Additionally, clearly mark subscriptions (for ex. production, non-prod) using tags and create a naming system to clearly identify and categorize Azure resources, especially those processing sensitive data. It is your responsibility to prioritize the remediation of alerts based on the criticality of the Azure resources and environment where the incident occurred.

* [Security alerts in Microsoft Defender for Cloud](/en-us/azure/security-center/security-center-alerts-overview)
* [Use tags to organize your Azure resources](/en-us/azure/azure-resource-manager/management/tag-resources)

**Responsibility**: Customer

### 10.3: Test security response procedures

**Guidance**: Conduct exercises to test your systemsâ incident response capabilities on a regular cadence to help protect your Azure resources.

* [Identify weak points and gaps and revise plan as needed. Refer to NIST's publication: Guide to Test, Training, and Exercise Programs for IT Plans and Capabilities](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-84.pdf)

**Responsibility**: Customer

### 10.4: Provide security incident contact details and configure alert notifications for security incidents

**Guidance**: Security incident contact information will be used by Microsoft to contact you if the Microsoft Security Response Center (MSRC) discovers that your data has been accessed by an unlawful or unauthorized party. Review incidents after the fact to ensure that issues are resolved.

* [How to set the Microsoft Defender for Cloud Security Contact](/en-us/azure/security-center/security-center-provide-security-contact-details)

**Responsibility**: Customer

### 10.5: Incorporate security alerts into your incident response system

**Guidance**: Export your Microsoft Defender for Cloud alerts and recommendations using the Continuous Export feature to help identify risks to Azure resources. Continuous Export allows you to export alerts and recommendations either manually or in an ongoing, continuous fashion. You may use the Microsoft Defender for Cloud data connector to stream the alerts to Microsoft Sentinel.

* [How to configure continuous export](/en-us/azure/security-center/continuous-export)
* [How to stream alerts into Microsoft Sentinel](/en-us/azure/sentinel/connect-azure-security-center)

**Responsibility**: Customer

### 10.6: Automate the response to security alerts

**Guidance**: Use the Workflow Automation feature in Microsoft Defender for Cloud to automatically trigger responses via "Logic Apps" on security alerts and recommendations to protect your Azure resources.

* [How to configure Workflow Automation and Logic Apps](/en-us/azure/security-center/workflow-automation)

**Responsibility**: Customer

## Penetration Tests and Red Team Exercises

*For more information, see the [Azure Security Benchmark: Penetration Tests and Red Team Exercises](../security-control-penetration-tests-red-team-exercises).*

### 11.1: Conduct regular penetration testing of your Azure resources and ensure remediation of all critical security findings

**Guidance**: Follow the Microsoft Rules of Engagement to ensure your Penetration Tests are not in violation of Microsoft policies. Use Microsoftâs strategy and execution of Red Teaming and live site penetration testing against Microsoft-managed cloud infrastructure, services, and applications.

* [Penetration Testing Rules of Engagement](https://www.microsoft.com/msrc/pentest-rules-of-engagement?rtc=1)
* [Microsoft Cloud Red Teaming](https://download.microsoft.com/download/C/1/9/C1990DBA-502F-4C2A-848D-392B93D9B9C3/Microsoft_Enterprise_Cloud_Red_Teaming.pdf)

**Responsibility**: Shared

## Next steps

* See the [Azure Security Benchmark V2 overview](../overview)
* Learn more about [Azure security baselines](../security-baselines-overview)

## Feedback

Submit and view feedback for

[This product](https://feedback.azure.com/forums/216840-security-and-compliance)
This page

[View all page feedback](https://github.com/MicrosoftDocs/azure-docs/issues)

---
